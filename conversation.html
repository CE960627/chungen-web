<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦ç”¨ç”Ÿæ´»è‹±æ–‡ | Daily Conversation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #FFFFFF;
            color: #1F2937;
            -webkit-font-smoothing: antialiased;
        }
        .en-font { font-family: 'Inter', sans-serif !important; letter-spacing: -0.01em; }
        .zh-font { font-family: 'Noto Sans TC', sans-serif !important; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #E5E7EB; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #D1D5DB; }
        .card-anim { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .card-anim:hover { transform: translateY(-4px); box-shadow: 0 12px 24px -6px rgba(0, 0, 0, 0.08); }
        .btn-click:active { transform: scale(0.96); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .input-focus:focus { outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15); border-color: #6366F1; }
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 0.3s, transform 0.3s; }
        .hidden-content { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #4f46e5; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-slate-50">

    <nav class="bg-gray-900 text-white shadow-lg sticky top-0 z-[60]">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <a href="index.html" class="font-bold text-xl tracking-wider hover:text-blue-400 transition">
                    æä»²æ©è‹±æ–‡
                </a>
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="hover:text-blue-400 transition duration-300">GSAT æ»¿ç´šåˆ†ç³»çµ±</a>
                    <a href="vocab.html" class="hover:text-yellow-400 transition duration-300">æ­·å±†é«˜é »å–®å­—ç¥å™¨</a>
                    <a href="conversation.html" class="text-green-400 font-bold border-b-2 border-green-400">è‹±èªç”Ÿå­˜æ¨¡æ“¬å™¨</a>
                    <a href="tutoring.html" class="hover:text-blue-400 transition duration-300">é—œæ–¼æˆ‘ / å®¶æ•™èª²ç¨‹</a>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="global-mobile-menu-btn" class="outline-none mobile-menu-button">
                        <svg class="w-6 h-6 hover:text-blue-400" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
                            <path d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="global-mobile-menu" class="hidden md:hidden bg-gray-800">
            <a href="index.html" class="block py-3 px-4 text-sm hover:bg-gray-700 border-b border-gray-700">GSAT æ»¿ç´šåˆ†ç³»çµ±</a>
            <a href="vocab.html" class="block py-3 px-4 text-sm hover:bg-gray-700 border-b border-gray-700">æ­·å±†é«˜é »å–®å­—ç¥å™¨</a>
            <a href="conversation.html" class="block py-3 px-4 text-sm text-green-400 font-bold border-b border-gray-700">è‹±èªç”Ÿå­˜æ¨¡æ“¬å™¨</a>
            <a href="tutoring.html" class="block py-3 px-4 text-sm hover:bg-gray-700">é—œæ–¼æˆ‘ / å®¶æ•™èª²ç¨‹</a>
        </div>
    </nav>

    <nav class="sticky top-16 z-50 bg-white/90 backdrop-blur-md border-b border-gray-100 shadow-sm">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-between h-16 gap-4">
                <button onclick="goHome()" class="font-bold text-gray-900 text-lg tracking-tight btn-click hover:opacity-60 transition-opacity whitespace-nowrap flex items-center gap-2">
                    <i class="ph-fill ph-chats-teardrop text-indigo-600"></i>
                    Daily Conversation
                </button>

                <div id="filter-container" class="flex-1 flex overflow-x-auto px-2 gap-2 justify-start items-center no-scrollbar mask-linear">
                    </div>
            </div>
        </div>
    </nav>

    <main id="main-container" class="flex-grow max-w-5xl mx-auto w-full px-4 py-8 transition-all duration-300">
        
        <div id="view-home" class="fade-enter-active">
            <div class="text-center py-12 md:py-20">
                <span class="inline-block py-1 px-3 rounded-full bg-indigo-50 text-indigo-600 text-sm font-medium mb-6">
                    ç”Ÿæ´»è‹±æ–‡æœƒè©±å¤§è£œå¸–
                </span>
                <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6 tracking-tight leading-tight">
                    è®“<span class="text-indigo-600">ä»²æ©</span>æˆç‚ºä½ çš„<br/><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-500">éš¨èº«è‹±èªæ•™ç·´</span>
                </h1>
                <p class="text-gray-500 text-lg md:text-xl max-w-2xl mx-auto mb-12 leading-relaxed">
                    ç²¾é¸ 10 å¤§ç”Ÿæ´»ä¸»é¡Œã€40 å€‹å¯¦ç”¨ç¯„ä¾‹ã€‚<br class="hidden md:block">ç«‹å³é–‹å§‹æœ€çœŸå¯¦çš„å°è©±ç·´ç¿’ã€‚
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto text-left">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-indigo-100 transition-colors group">
                        <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600 mb-4 group-hover:scale-110 transition-transform">
                            <i class="ph-duotone ph-squares-four text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">1. é¸æ“‡æƒ…å¢ƒ</h3>
                        <p class="text-gray-500 text-sm leading-relaxed">
                            é»æ“Šä¸Šæ–¹é¸å–®é¸æ“‡ä½ æƒ³ç·´ç¿’çš„ä¸»é¡Œï¼Œä¾‹å¦‚ã€Œæ©Ÿå ´ã€ã€ã€Œé¤å»³ã€æˆ–ã€Œè³¼ç‰©ã€ã€‚
                        </p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-indigo-100 transition-colors group">
                        <div class="w-12 h-12 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600 mb-4 group-hover:scale-110 transition-transform">
                            <i class="ph-duotone ph-copy text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">2. è¤‡è£½è¨­å®š</h3>
                        <p class="text-gray-500 text-sm leading-relaxed">
                            ä¸€éµè¤‡è£½ã€Œè§’è‰²è¨­å®šæŒ‡ä»¤ã€ï¼Œè²¼çµ¦ ChatGPT æˆ– Geminiï¼Œè®“å®ƒæ‰®æ¼”å°æ‡‰è§’è‰²ã€‚
                        </p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:border-indigo-100 transition-colors group">
                        <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center text-green-600 mb-4 group-hover:scale-110 transition-transform">
                            <i class="ph-duotone ph-chats-circle text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">3. é–‹å§‹å°è©±</h3>
                        <p class="text-gray-500 text-sm leading-relaxed">
                            åƒè€ƒç¯„ä¾‹å¥å­èˆ‡ AI å°è©±ï¼Œæˆ–è¼¸å…¥ä¸­æ–‡è®“ç³»çµ±ç”Ÿæˆæ–°çš„ç·´ç¿’å¥ã€‚
                        </p>
                    </div>
                </div>

                <div class="mt-16">
                    <p class="text-sm text-gray-400 mb-4">æº–å‚™å¥½äº†å—ï¼Ÿé»æ“Šä¸Šæ–¹ä»»ä¸€æƒ…å¢ƒé–‹å§‹ ğŸ˜Š</p>
                </div>
            </div>
        </div>

        <div id="view-scenario" class="hidden-content">
            
            <section id="scene-header" class="mb-10 bg-white border border-gray-200 rounded-3xl p-6 md:p-8 shadow-sm relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-indigo-50 to-transparent rounded-bl-full -mr-16 -mt-16 opacity-50 transition-transform group-hover:scale-110"></div>
                
                <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                    <div>
                        <div class="flex items-center gap-2 text-indigo-600 mb-3 font-bold text-xs uppercase tracking-widest">
                            <i class="ph-fill ph-target"></i>
                            <span>CURRENT MISSION</span>
                        </div>
                        <h2 id="scene-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">æƒ…å¢ƒæ¨™é¡Œ</h2>
                        <p id="scene-desc" class="text-gray-500 text-base max-w-xl leading-relaxed">
                            </p>
                    </div>
                    <button onclick="copyScenePrompt(this)" class="w-full md:w-auto flex items-center justify-center gap-2 bg-gray-900 text-white px-6 py-3.5 rounded-xl font-bold shadow-lg shadow-gray-200 hover:bg-gray-800 hover:-translate-y-0.5 transition-all btn-click">
                        <i class="ph-bold ph-copy text-lg"></i>
                        <span>è¤‡è£½ AI è§’è‰²è¨­å®š</span>
                    </button>
                </div>
            </section>

            <div id="scenarios-grid" class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-16">
                </div>

            <div class="relative flex py-5 items-center mb-10">
                <div class="flex-grow border-t border-gray-200"></div>
                <span class="flex-shrink-0 mx-4 text-gray-400 text-sm font-medium tracking-widest uppercase">Custom Practice</span>
                <div class="flex-grow border-t border-gray-200"></div>
            </div>

            <section class="max-w-2xl mx-auto mb-16">
                <div class="bg-white rounded-2xl p-1 shadow-sm border border-indigo-100 ring-4 ring-indigo-50/50">
                    <div class="p-6 md:p-8">
                        <div class="text-center mb-6">
                            <div class="inline-flex items-center justify-center w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full mb-3">
                                <i class="ph-fill ph-magic-wand text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900">é‚„æƒ³ç·´ç¿’ä»€éº¼å¥å­å‘¢?</h3>
                            <p class="text-gray-500 text-sm mt-1">é»æ“Šä¸‹æ–¹å»ºè­°ï¼Œæˆ–è¼¸å…¥ä¸­æ–‡è‡ªå‹•ç¿»è­¯ç”Ÿæˆå¡ç‰‡</p>
                        </div>

                        <div class="relative flex items-center mb-6">
                            <input 
                                type="text" 
                                id="custom-zh" 
                                placeholder="è¼¸å…¥æƒ³å­¸çš„ä¸­æ–‡å¥å­..." 
                                class="w-full pl-5 pr-14 py-4 bg-gray-50 border border-gray-200 rounded-xl text-gray-800 placeholder-gray-400 font-medium input-focus transition-all text-lg"
                                onkeydown="if(event.key === 'Enter') handleCustomInput()"
                            >
                            <button 
                                id="add-btn"
                                onclick="handleCustomInput()" 
                                class="absolute right-2 p-2.5 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors btn-click flex items-center justify-center"
                                title="ç”Ÿæˆç·´ç¿’å¡"
                            >
                                <i class="ph-bold ph-plus text-lg"></i>
                            </button>
                        </div>

                        <div id="suggestion-area" class="flex flex-wrap justify-center gap-2">
                            </div>

                    </div>
                </div>
            </section>

            <div id="custom-cards-container" class="max-w-4xl mx-auto space-y-4 mb-12 hidden">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i class="ph-fill ph-notebook text-indigo-600"></i>
                    æˆ‘çš„ç·´ç¿’æ¸…å–®
                </h3>
                
                <div id="custom-list-capture" class="bg-slate-50 p-6 rounded-2xl border border-gray-100">
                    <div id="custom-list" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        </div>
                    <div class="text-center mt-8 text-gray-400 text-xs font-medium tracking-widest">
                        Daily Conversation Practice by Chungen
                    </div>
                </div>
                
                <div class="text-center pt-6">
                    <button onclick="downloadStudyImage()" class="inline-flex items-center gap-2 px-6 py-3 bg-white border border-gray-300 shadow-sm text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors btn-click">
                        <i class="ph-bold ph-image"></i>
                        ä¸‹è¼‰ç‚ºåœ–ç‰‡ (Image)
                    </button>
                </div>
            </div>

        </div>

    </main>

    <footer class="py-8 text-center text-gray-300 text-xs">
        <p>Â© 2025 Chungen English.</p>
    </footer>

    <script>
        // --- Configuration with Updated Prompt ---
        const categorySettings = {
            'Greetings': { display: 'æ—¥å¸¸æ‹›å‘¼', icon: 'ph-hand-waving', prompt: "Act as a friendly native English speaker. We are having a casual conversation. Respond naturally to my greetings and ask follow-up questions. practice English daily conversation." },
            'Shopping': { display: 'é€›è¡—è³¼ç‰©', icon: 'ph-shopping-bag', prompt: "Act as a helpful shop assistant. I am a customer. Answer my questions about products, prices, and availability. practice English daily conversation." },
            'Dining': { display: 'ç”¨é¤è¨‚ä½', icon: 'ph-fork-knife', prompt: "Act as a professional waiter. I am a customer. Take my order, explain the menu, and handle my requests. practice English daily conversation." },
            'Housing': { display: 'ç§Ÿå±‹ä½å®¿', icon: 'ph-house-line', prompt: "Act as a hotel receptionist or landlord. I am asking about accommodation details, utilities, or rules. practice English daily conversation." },
            'Transport': { display: 'é€šå‹¤äº¤é€š', icon: 'ph-taxi', prompt: "Act as a taxi driver or commuter. I am asking for a ride, directions, or discussing traffic conditions. practice English daily conversation." },
            'Directions': { display: 'è¡—ä¸Šå•è·¯', icon: 'ph-map-pin', prompt: "Act as a local. I am a lost tourist asking for directions. Give clear instructions. practice English daily conversation." },
            'Airport': { display: 'æ©Ÿå ´å‡ºåœ‹', icon: 'ph-airplane-takeoff', prompt: "Act as airline staff or security. I am a traveler. Check my documents and help me check in. practice English daily conversation." },
            'Entertainment': { display: 'å‡æ—¥å¨›æ¨‚', icon: 'ph-confetti', prompt: "Act as a close friend. Discuss weekend plans, hobbies, or going out for a drink. practice English daily conversation." },
            'Medical': { display: 'å°±é†«æ‡‰ç­”', icon: 'ph-first-aid', prompt: "Act as a doctor. I am a patient describing symptoms. Give medical advice and ask questions. practice English daily conversation." },
            'Farewell': { display: 'é“åˆ¥ç¥è³€', icon: 'ph-handshake', prompt: "Act as a friend or colleague. We are saying goodbye. Match the tone (formal or casual). practice English daily conversation." }
        };

        // --- SUGGESTIONS DATA ---
        const suggestionsDB = {
            'Greetings': [
                { zh: "å¥½ä¹…ä¸è¦‹ï¼", en: "Long time no see!", kw: [{en:"Long time", zh:"å¥½ä¹…"}, {en:"See", zh:"è¦‹"}] },
                { zh: "ä½ é€±æœ«éå¾—å¦‚ä½•ï¼Ÿ", en: "How was your weekend?", kw: [{en:"Weekend", zh:"é€±æœ«"}, {en:"How", zh:"å¦‚ä½•"}] },
                { zh: "å®¶è£¡ä¸€åˆ‡éƒ½å¥½å—ï¼Ÿ", en: "How is your family doing?", kw: [{en:"Family", zh:"å®¶åº­"}, {en:"Doing", zh:"ç‹€æ³"}] },
                { zh: "æœ€è¿‘å·¥ä½œå¿™å—ï¼Ÿ", en: "Have you been busy with work lately?", kw: [{en:"Busy", zh:"å¿™ç¢Œ"}, {en:"Lately", zh:"æœ€è¿‘"}] },
                { zh: "å¤©æ°£çœŸä¸éŒ¯ï¼", en: "The weather is really nice!", kw: [{en:"Weather", zh:"å¤©æ°£"}, {en:"Nice", zh:"ä¸éŒ¯"}] }
            ],
            'Shopping': [
                { zh: "é€™ä»¶å¯ä»¥æ‰“æŠ˜å—ï¼Ÿ", en: "Can I get a discount on this?", kw: [{en:"Discount", zh:"æŠ˜æ‰£"}] },
                { zh: "è«‹å•è©¦è¡£é–“åœ¨å“ªè£¡ï¼Ÿ", en: "Where is the fitting room?", kw: [{en:"Fitting room", zh:"è©¦è¡£é–“"}] },
                { zh: "é€™å€‹æœ‰å¤§ä¸€é»çš„å°ºå¯¸å—ï¼Ÿ", en: "Do you have this in a larger size?", kw: [{en:"Larger", zh:"æ›´å¤§"}, {en:"Size", zh:"å°ºå¯¸"}] },
                { zh: "å¯ä»¥åˆ·å¡å—ï¼Ÿ", en: "Do you accept credit cards?", kw: [{en:"Credit card", zh:"ä¿¡ç”¨å¡"}, {en:"Accept", zh:"æ¥å—"}] }
            ],
            'Dining': [
                { zh: "è«‹å•æœ‰ç´ é£Ÿé¤é»å—ï¼Ÿ", en: "Do you have any vegetarian dishes?", kw: [{en:"Vegetarian", zh:"ç´ é£Ÿ"}, {en:"Dish", zh:"èœé¤š"}] },
                { zh: "æˆ‘ä¸åƒè¾£ï¼Œè«‹å¹«æˆ‘æ³¨æ„", en: "I don't eat spicy food, please make a note.", kw: [{en:"Spicy", zh:"è¾£"}, {en:"Note", zh:"æ³¨æ„"}] },
                { zh: "é€™é“èœè£¡é¢æœ‰ä»€éº¼é£Ÿæï¼Ÿ", en: "What ingredients are in this dish?", kw: [{en:"Ingredients", zh:"é£Ÿæ"}] },
                { zh: "æˆ‘å€‘å¯ä»¥åˆ†é–‹çµå¸³å—ï¼Ÿ", en: "Can we split the bill?", kw: [{en:"Split", zh:"åˆ†é–‹"}, {en:"Bill", zh:"å¸³å–®"}] }
            ],
            'Housing': [
                { zh: "ç†±æ°´å™¨å¥½åƒå£äº†", en: "The water heater seems to be broken.", kw: [{en:"Water heater", zh:"ç†±æ°´å™¨"}, {en:"Broken", zh:"å£æ‰"}] },
                { zh: "è«‹å•åƒåœ¾è¦ä¸Ÿå“ªè£¡ï¼Ÿ", en: "Where should I throw the trash?", kw: [{en:"Trash", zh:"åƒåœ¾"}, {en:"Throw", zh:"ä¸Ÿ"}] },
                { zh: "æˆ‘æƒ³çºŒç§Ÿä¸€å¹´", en: "I would like to renew the lease for another year.", kw: [{en:"Renew", zh:"çºŒç´„"}, {en:"Lease", zh:"ç§Ÿç´„"}] },
                { zh: "æˆ¿é–“å†·æ°£ä¸å†·", en: "The air conditioner in the room isn't cold.", kw: [{en:"AC", zh:"å†·æ°£"}, {en:"Cold", zh:"å†·"}] }
            ],
            'Transport': [
                { zh: "è«‹é–‹å¿«ä¸€é»ï¼Œæˆ‘è¶•æ™‚é–“", en: "Please drive a bit faster, I'm in a hurry.", kw: [{en:"Faster", zh:"å¿«é»"}, {en:"Hurry", zh:"è¶•æ™‚é–“"}] },
                { zh: "å¯ä»¥åœ¨å‰é¢çš„è·¯å£åœå—ï¼Ÿ", en: "Can you stop at the intersection ahead?", kw: [{en:"Stop", zh:"åœ"}, {en:"Intersection", zh:"è·¯å£"}] },
                { zh: "è«‹å•é€™ç­è»Šæœƒåˆ°ç«è»Šç«™å—ï¼Ÿ", en: "Does this bus go to the train station?", kw: [{en:"Bus", zh:"å…¬è»Š"}, {en:"Train station", zh:"ç«è»Šç«™"}] },
                { zh: "è»Šè²»ç¸½å…±å¤šå°‘éŒ¢ï¼Ÿ", en: "How much is the total fare?", kw: [{en:"Total", zh:"ç¸½å…±"}, {en:"Fare", zh:"è»Šè²»"}] }
            ],
            'Directions': [
                { zh: "è«‹å•æœ€è¿‘çš„ä¾¿åˆ©å•†åº—åœ¨å“ªï¼Ÿ", en: "Where is the nearest convenience store?", kw: [{en:"Nearest", zh:"æœ€è¿‘"}, {en:"Convenience store", zh:"ä¾¿åˆ©å•†åº—"}] },
                { zh: "é€™é™„è¿‘æœ‰è—¥å±€å—ï¼Ÿ", en: "Is there a pharmacy nearby?", kw: [{en:"Pharmacy", zh:"è—¥å±€"}, {en:"Nearby", zh:"é™„è¿‘"}] },
                { zh: "é€™æ¢è·¯é€šå¾€å¸‚ä¸­å¿ƒå—ï¼Ÿ", en: "Does this road lead to the city center?", kw: [{en:"Lead to", zh:"é€šå¾€"}, {en:"City center", zh:"å¸‚ä¸­å¿ƒ"}] },
                { zh: "æˆ‘å¥½åƒè¿·è·¯äº†", en: "I think I'm lost.", kw: [{en:"Lost", zh:"è¿·è·¯"}] }
            ],
            'Airport': [
                { zh: "æˆ‘çš„è¡Œæå¥½åƒéºå¤±äº†", en: "My luggage seems to be missing.", kw: [{en:"Luggage", zh:"è¡Œæ"}, {en:"Missing", zh:"éºå¤±"}] },
                { zh: "æˆ‘æƒ³æ›åˆ°é çª—çš„åº§ä½", en: "I'd like to change to a window seat.", kw: [{en:"Change", zh:"æ›´æ›"}, {en:"Window seat", zh:"é çª—åº§"}] },
                { zh: "è«‹å•ç™»æ©Ÿæ™‚é–“æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", en: "What is the boarding time?", kw: [{en:"Boarding", zh:"ç™»æ©Ÿ"}] },
                { zh: "è«‹å•å“ªè£¡å¯ä»¥é ˜å–è¡Œæï¼Ÿ", en: "Where can I claim my luggage?", kw: [{en:"Claim", zh:"é ˜å–"}] }
            ],
            'Entertainment': [
                { zh: "é€™å€‹é€±æœ«è¦ä¸è¦å»çœ‹é›»å½±ï¼Ÿ", en: "Do you want to see a movie this weekend?", kw: [{en:"Movie", zh:"é›»å½±"}, {en:"Weekend", zh:"é€±æœ«"}] },
                { zh: "ä½ æƒ³ä¸€èµ·å»å”±å¡æ‹‰OKå—ï¼Ÿ", en: "Do you want to go to Karaoke together?", kw: [{en:"Karaoke", zh:"å¡æ‹‰OK"}, {en:"Together", zh:"ä¸€èµ·"}] },
                { zh: "é‚£å®¶é…’å§çš„æ°£æ°›å¾ˆå¥½", en: "That bar has a great atmosphere.", kw: [{en:"Bar", zh:"é…’å§"}, {en:"Atmosphere", zh:"æ°£æ°›"}] },
                { zh: "æœ€è¿‘æœ‰ä»€éº¼æ¨è–¦çš„å½±é›†å—ï¼Ÿ", en: "Any recommended TV series lately?", kw: [{en:"Recommended", zh:"æ¨è–¦"}, {en:"Series", zh:"å½±é›†"}] }
            ],
            'Medical': [
                { zh: "æˆ‘æ˜¨æ™šé–‹å§‹ç™¼ç‡’", en: "I started having a fever last night.", kw: [{en:"Fever", zh:"ç™¼ç‡’"}, {en:"Last night", zh:"æ˜¨æ™š"}] },
                { zh: "æˆ‘çš„èƒƒå¾ˆä¸èˆ’æœ", en: "My stomach feels very uncomfortable.", kw: [{en:"Stomach", zh:"èƒƒ"}, {en:"Uncomfortable", zh:"ä¸èˆ’æœ"}] },
                { zh: "é€™å€‹è—¥æœƒæœ‰å‰¯ä½œç”¨å—ï¼Ÿ", en: "Does this medicine have any side effects?", kw: [{en:"Medicine", zh:"è—¥"}, {en:"Side effects", zh:"å‰¯ä½œç”¨"}] },
                { zh: "æˆ‘æœ‰è—¥ç‰©éæ•", en: "I have drug allergies.", kw: [{en:"Allergy", zh:"éæ•"}] }
            ],
            'Farewell': [
                { zh: "ä¿æŒè¯çµ¡ï¼", en: "Keep in touch!", kw: [{en:"Keep", zh:"ä¿æŒ"}, {en:"Touch", zh:"è¯çµ¡"}] },
                { zh: "ç¥ä½ æ—…é€”æ„‰å¿«", en: "Have a nice trip!", kw: [{en:"Nice", zh:"æ„‰å¿«"}, {en:"Trip", zh:"æ—…é€”"}] },
                { zh: "å¸Œæœ›å¾ˆå¿«èƒ½å†è¦‹åˆ°ä½ ", en: "Hope to see you again soon.", kw: [{en:"Soon", zh:"å¾ˆå¿«"}] },
                { zh: "é€±æœ«æ„‰å¿«ï¼", en: "Have a nice weekend!", kw: [{en:"Weekend", zh:"é€±æœ«"}] }
            ]
        };

        const initialScenarios = [
            // 1. Greetings (æ—¥å¸¸æ‹›å‘¼èª)
            { category: 'Greetings', title: 'å•å€™ 1', goldenSentence: "How is it going?", chinese: "æœ€è¿‘é‚„è¡Œå—ï¼Ÿ", keywords: [{en:'Going', zh:'é€²å±•'}, {en:'Lately', zh:'æœ€è¿‘'}] },
            { category: 'Greetings', title: 'å•å€™ 2', goldenSentence: "Howâ€™s your day?", chinese: "ä»Šå¤©éå¾—å¦‚ä½•ï¼Ÿ", keywords: [{en:'Day', zh:'æ—¥å­'}, {en:'Feeling', zh:'æ„Ÿè¦º'}] },
            { category: 'Greetings', title: 'å•å€™ 3', goldenSentence: "Whatâ€™s new?", chinese: "æœ€è¿‘æœ‰ä»€éº¼æ–°é®®äº‹å—ï¼Ÿ", keywords: [{en:'New', zh:'æ–°é®®äº‹'}, {en:'Update', zh:'è¿‘æ³'}] },
            { category: 'Greetings', title: 'å•å€™ 4', goldenSentence: "Good to see you!", chinese: "å¾ˆé«˜èˆˆè¦‹åˆ°ä½ ï¼", keywords: [{en:'See', zh:'è¦‹é¢'}, {en:'Glad', zh:'é«˜èˆˆ'}] },

            // 2. Shopping (é€›è¡—è³¼ç‰©)
            { category: 'Shopping', title: 'è³¼ç‰© 1', goldenSentence: "Iâ€™m just looking around.", chinese: "æˆ‘åªæ˜¯éš¨ä¾¿çœ‹çœ‹ã€‚", keywords: [{en:'Looking', zh:'çœ‹'}, {en:'Browsing', zh:'ç€è¦½'}] },
            { category: 'Shopping', title: 'è³¼ç‰© 2', goldenSentence: "Excuse me, Iâ€™m looking for...", chinese: "ä¸å¥½æ„æ€ï¼Œæˆ‘åœ¨æ‰¾...", keywords: [{en:'Looking for', zh:'å°‹æ‰¾'}, {en:'Item', zh:'ç‰©å“'}] },
            { category: 'Shopping', title: 'è³¼ç‰© 3', goldenSentence: "How much is this?", chinese: "é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ", keywords: [{en:'Price', zh:'åƒ¹æ ¼'}, {en:'Cost', zh:'è²»ç”¨'}] },
            { category: 'Shopping', title: 'è³¼ç‰© 4', goldenSentence: "Do you have any other colors for this?", chinese: "é€™å€‹æœ‰å…¶ä»–é¡è‰²å—ï¼Ÿ", keywords: [{en:'Color', zh:'é¡è‰²'}, {en:'Stock', zh:'åº«å­˜'}] },

            // 3. Dining (ç”¨é¤è¨‚ä½)
            { category: 'Dining', title: 'ç”¨é¤ 1', goldenSentence: "I would like to make a reservation, please.", chinese: "æˆ‘æƒ³è¦è¨‚ä½ã€‚", keywords: [{en:'Reservation', zh:'é ç´„'}, {en:'Table', zh:'æ¡Œå­'}] },
            { category: 'Dining', title: 'ç”¨é¤ 2', goldenSentence: "Weâ€™re ready to order.", chinese: "æˆ‘å€‘æº–å‚™å¥½è¦é»é¤äº†ã€‚", keywords: [{en:'Order', zh:'é»é¤'}, {en:'Ready', zh:'æº–å‚™å¥½'}] },
            { category: 'Dining', title: 'ç”¨é¤ 3', goldenSentence: "Could I please have an extra spoon?", chinese: "å¯ä»¥å†å¤šçµ¦æˆ‘å€‘ä¸€æ”¯æ¹¯åŒ™å—ï¼Ÿ", keywords: [{en:'Spoon', zh:'æ¹¯åŒ™'}, {en:'Extra', zh:'é¡å¤–'}] },
            { category: 'Dining', title: 'ç”¨é¤ 4', goldenSentence: "Can we have our check please?", chinese: "æˆ‘å€‘æƒ³è¦çµå¸³äº†ã€‚", keywords: [{en:'Check', zh:'å¸³å–®'}, {en:'Bill', zh:'è²»ç”¨'}] },

            // 4. Housing (ç§Ÿå±‹ä½å®¿)
            { category: 'Housing', title: 'ä½å®¿ 1', goldenSentence: "I need to do my laundry today.", chinese: "æˆ‘ä»Šå¤©è¦æ´—è¡£æœã€‚", keywords: [{en:'Laundry', zh:'æ´—è¡£'}, {en:'Wash', zh:'æ¸…æ´—'}] },
            { category: 'Housing', title: 'ä½å®¿ 2', goldenSentence: "How much are the electricity bills for a year?", chinese: "é›»è²»ä¸€å¹´è¦å¤šå°‘éŒ¢ï¼Ÿ", keywords: [{en:'Electricity', zh:'é›»åŠ›'}, {en:'Bill', zh:'å¸³å–®'}] },
            { category: 'Housing', title: 'ä½å®¿ 3', goldenSentence: "Which city do you live in?", chinese: "ä½ å®¶ä½åœ¨å“ªå€‹åŸå¸‚ï¼Ÿ", keywords: [{en:'City', zh:'åŸå¸‚'}, {en:'Live', zh:'å±…ä½'}] },
            { category: 'Housing', title: 'ä½å®¿ 4', goldenSentence: "Iâ€™ll stay at Sheraton Hotel tomorrow.", chinese: "æˆ‘æ˜å¤©æœƒä½åœ¨å–œä¾†ç™»é…’åº—ã€‚", keywords: [{en:'Stay', zh:'åœç•™'}, {en:'Hotel', zh:'é£¯åº—'}] },

            // 5. Transport (é€šå‹¤äº¤é€š)
            { category: 'Transport', title: 'äº¤é€š 1', goldenSentence: "Please take me to Grand Hotel. Thank you.", chinese: "è«‹è¼‰æˆ‘åˆ°åœ“å±±å¤§é£¯åº—ï¼Œè¬è¬ã€‚", keywords: [{en:'Take', zh:'è¼‰é€'}, {en:'Destination', zh:'ç›®çš„åœ°'}] },
            { category: 'Transport', title: 'äº¤é€š 2', goldenSentence: "Iâ€™ll drive you home.", chinese: "æˆ‘ç­‰ç­‰è¼‰ä½ å›å®¶ã€‚", keywords: [{en:'Drive', zh:'é–‹è»Š'}, {en:'Ride', zh:'æ­ä¾¿è»Š'}] },
            { category: 'Transport', title: 'äº¤é€š 3', goldenSentence: "How far is your office from your home?", chinese: "ä½ çš„è¾¦å…¬å®¤è·é›¢å®¶è£¡æœ‰å¤šé ï¼Ÿ", keywords: [{en:'Far', zh:'é '}, {en:'Distance', zh:'è·é›¢'}] },
            { category: 'Transport', title: 'äº¤é€š 4', goldenSentence: "The traffic was really bad.", chinese: "äº¤é€šç‹€æ³å¾ˆå·®ã€‚", keywords: [{en:'Traffic', zh:'äº¤é€š'}, {en:'Jam', zh:'å¡è»Š'}] },

            // 6. Directions (è¡—ä¸Šå•è·¯)
            { category: 'Directions', title: 'å•è·¯ 1', goldenSentence: "Where is the bus stop?", chinese: "å…¬è»Šç«™åœ¨å“ªè£ï¼Ÿ", keywords: [{en:'Bus stop', zh:'å…¬è»Šç«™'}, {en:'Where', zh:'å“ªè£¡'}] },
            { category: 'Directions', title: 'å•è·¯ 2', goldenSentence: "Where is the nearest MRT station?", chinese: "æœ€è¿‘çš„æ·é‹ç«™åœ¨å“ªï¼Ÿ", keywords: [{en:'MRT', zh:'æ·é‹'}, {en:'Nearest', zh:'æœ€è¿‘'}] },
            { category: 'Directions', title: 'å•è·¯ 3', goldenSentence: "How can I get to your place?", chinese: "æˆ‘è¦æ€éº¼å»ä½ å®¶ï¼Ÿ", keywords: [{en:'Get to', zh:'æŠµé”'}, {en:'Route', zh:'è·¯ç·š'}] },
            { category: 'Directions', title: 'å•è·¯ 4', goldenSentence: "You can take a bus to get there.", chinese: "ä½ å¯ä»¥æ­å…¬è»Šåˆ°é‚£é‚Šã€‚", keywords: [{en:'Take', zh:'æ­ä¹˜'}, {en:'Bus', zh:'å…¬è»Š'}] },

            // 7. Airport (æ©Ÿå ´å‡ºåœ‹)
            { category: 'Airport', title: 'æ©Ÿå ´ 1', goldenSentence: "Is this the right counter to check in for this flight?", chinese: "è«‹å•é€™å€‹èˆªç­æ˜¯åœ¨é€™å€‹æ«ƒæª¯è¾¦ç™»æ©Ÿå—ï¼Ÿ", keywords: [{en:'Counter', zh:'æ«ƒæª¯'}, {en:'Check-in', zh:'å ±åˆ°'}] },
            { category: 'Airport', title: 'æ©Ÿå ´ 2', goldenSentence: "Can I have an aisle seat, please?", chinese: "æˆ‘å¯ä»¥åèµ°é“æ—é‚Šå—ï¼Ÿ", keywords: [{en:'Aisle seat', zh:'èµ°é“ä½'}, {en:'Window', zh:'é çª—'}] },
            { category: 'Airport', title: 'æ©Ÿå ´ 3', goldenSentence: "Can I take this through security?", chinese: "é€™å€‹å¯ä»¥éå®‰æª¢å—ï¼Ÿ", keywords: [{en:'Security', zh:'å®‰æª¢'}, {en:'Allowed', zh:'å…è¨±'}] },
            { category: 'Airport', title: 'æ©Ÿå ´ 4', goldenSentence: "Which gate should I get on board?", chinese: "è«‹å•æˆ‘è¦åˆ°å“ªä¸€å€‹ç™»æ©Ÿé–€ï¼Ÿ", keywords: [{en:'Gate', zh:'ç™»æ©Ÿé–€'}, {en:'Board', zh:'ç™»æ©Ÿ'}] },

            // 8. Entertainment (å‡æ—¥å¨›æ¨‚)
            { category: 'Entertainment', title: 'å¨›æ¨‚ 1', goldenSentence: "Itâ€™s my round.", chinese: "æ›æˆ‘è«‹å¤§å®¶å–é…’äº†ã€‚", keywords: [{en:'My round', zh:'æˆ‘è«‹å®¢'}, {en:'Treat', zh:'æ‹›å¾…'}] },
            { category: 'Entertainment', title: 'å¨›æ¨‚ 2', goldenSentence: "I was blackout last night. I canâ€™t remember anything.", chinese: "æˆ‘æ˜¨å¤©å–åˆ°æ–·ç‰‡ï¼Œå®Œå…¨ä¸è¨˜å¾—ç™¼ç”Ÿä»€éº¼äº‹äº†ã€‚", keywords: [{en:'Blackout', zh:'æ–·ç‰‡'}, {en:'Drunk', zh:'é†‰'}] },
            { category: 'Entertainment', title: 'å¨›æ¨‚ 3', goldenSentence: "Can you show me some exercise for abs?", chinese: "ä½ èƒ½æ•™æˆ‘ä¸€äº›è…¹è‚Œé‹å‹•å—ï¼Ÿ", keywords: [{en:'Exercise', zh:'é‹å‹•'}, {en:'Abs', zh:'è…¹è‚Œ'}] },
            { category: 'Entertainment', title: 'å¨›æ¨‚ 4', goldenSentence: "What are your hobbies?", chinese: "ä½ æœ‰ä»€éº¼èˆˆè¶£ï¼Ÿ", keywords: [{en:'Hobbies', zh:'èˆˆè¶£'}, {en:'Interest', zh:'æ„›å¥½'}] },

            // 9. Medical (å°±é†«æ‡‰ç­”)
            { category: 'Medical', title: 'å°±é†« 1', goldenSentence: "What brings you here today?", chinese: "ä½ å“ªè£¡ä¸èˆ’æœï¼Ÿ(é†«ç”Ÿå•è¨º)", keywords: [{en:'Brings here', zh:'ä¾†çœ‹è¨ºåŸå› '}, {en:'Symptom', zh:'ç—‡ç‹€'}] },
            { category: 'Medical', title: 'å°±é†« 2', goldenSentence: "I have a sore throat.", chinese: "æˆ‘å–‰åš¨ç—›ã€‚", keywords: [{en:'Sore throat', zh:'å–‰åš¨ç—›'}, {en:'Pain', zh:'ç–¼ç—›'}] },
            { category: 'Medical', title: 'å°±é†« 3', goldenSentence: "Do you take any medicines or supplements?", chinese: "ä½ ç›®å‰æœ‰æœç”¨è—¥ç‰©æˆ–ä¿å¥é£Ÿå“å—ï¼Ÿ", keywords: [{en:'Medicine', zh:'è—¥ç‰©'}, {en:'Supplement', zh:'ä¿å¥å“'}] },
            { category: 'Medical', title: 'å°±é†« 4', goldenSentence: "How long have you been sick?", chinese: "ä½ ç”Ÿç—…å¤šä¹…äº†ï¼Ÿ", keywords: [{en:'How long', zh:'å¤šä¹…'}, {en:'Sick', zh:'ç”Ÿç—…'}] },

            // 10. Farewell (é“åˆ¥ç¥è³€)
            { category: 'Farewell', title: 'é“åˆ¥ 1', goldenSentence: "See you!", chinese: "å†è¦‹ï¼", keywords: [{en:'See you', zh:'å†è¦‹'}, {en:'Later', zh:'å¾…æœƒ'}] },
            { category: 'Farewell', title: 'é“åˆ¥ 2', goldenSentence: "It was a pleasure to meet you.", chinese: "å¾ˆé«˜èˆˆèªè­˜ä½ ã€‚", keywords: [{en:'Pleasure', zh:'æ¦®å¹¸'}, {en:'Meet', zh:'èªè­˜'}] },
            { category: 'Farewell', title: 'é“åˆ¥ 3', goldenSentence: "Until we meet again.", chinese: "å¾Œæœƒæœ‰æœŸã€‚", keywords: [{en:'Until', zh:'ç›´åˆ°'}, {en:'Meet again', zh:'å†æ¬¡ç›¸é‡'}] },
            { category: 'Farewell', title: 'é“åˆ¥ 4', goldenSentence: "Take care.", chinese: "ä¿é‡ã€‚", keywords: [{en:'Take care', zh:'ä¿é‡'}, {en:'Safe', zh:'å®‰å…¨'}] }
        ];

        // State
        let activeCategory = null;
        let currentScenarios = [...initialScenarios];
        // Store custom cards globally mapped by category to allow persistence
        const allCustomCards = {}; 

        // DOM Elements
        const viewHome = document.getElementById('view-home');
        const viewScenario = document.getElementById('view-scenario');
        const navContainer = document.getElementById('filter-container');
        const gridContainer = document.getElementById('scenarios-grid');
        const sceneTitleEl = document.getElementById('scene-title');
        const sceneDescEl = document.getElementById('scene-desc');
        const suggestionAreaEl = document.getElementById('suggestion-area');
        
        // New DOM Elements
        const customCardsContainer = document.getElementById('custom-cards-container');
        const customListEl = document.getElementById('custom-list');

        // --- View Management ---
        function goHome() {
            activeCategory = null;
            updateView();
            renderNav();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function setCategory(cat) {
            activeCategory = cat;
            
            // Initialize array for category if not exists
            if (!allCustomCards[cat]) {
                allCustomCards[cat] = [];
            }
            
            updateView();
            renderNav();
            renderHeader();
            renderGrid();
            renderSuggestions();
            renderCustomList(); // Render existing cards for this category
            
            // Force scroll to top regardless of device width
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateView() {
            if (activeCategory === null) {
                viewHome.classList.remove('hidden-content');
                viewScenario.classList.add('hidden-content');
                viewHome.classList.add('fade-enter-active');
            } else {
                viewHome.classList.add('hidden-content');
                viewScenario.classList.remove('hidden-content');
                viewScenario.classList.add('fade-enter-active');
            }
        }

        // --- Rendering ---

        function renderNav() {
            const categories = Object.keys(categorySettings);
            navContainer.innerHTML = categories.map(cat => {
                const isActive = cat === activeCategory;
                const setting = categorySettings[cat];
                return `
                    <button 
                        onclick="setCategory('${cat}')"
                        class="snap-start flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 whitespace-nowrap border btn-click
                        ${isActive 
                            ? 'bg-gray-900 text-white border-gray-900 shadow-md' 
                            : 'bg-white text-gray-500 border-gray-200 hover:border-gray-300 hover:text-gray-700'
                        }"
                    >
                        <i class="ph-bold ${setting.icon}"></i>
                        ${setting.display}
                    </button>
                `;
            }).join('');
        }

        function renderHeader() {
            if(!activeCategory) return;
            const setting = categorySettings[activeCategory];
            sceneTitleEl.innerText = setting.display;
            // Updated text as requested
            sceneDescEl.innerText = `AI å°‡æœƒæ‰®æ¼” a native English speakerã€‚é»æ“Šä¸‹æ–¹æŒ‰éˆ•è¤‡è£½è§’è‰²è¨­å®šï¼Œè²¼çµ¦ ChatGPT æˆ– Gemini å³å¯é–‹å§‹å°è©±ã€‚`;
        }

        function renderSuggestions() {
            if(!activeCategory) return;
            
            // Get rich objects
            const pool = suggestionsDB[activeCategory] || [];
            
            // Pick 3 random items
            const shuffled = [...pool].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 3);

            suggestionAreaEl.innerHTML = selected.map((item, index) => `
                <button 
                    onclick="addSuggestionCard('${item.zh}')"
                    class="px-3 py-1.5 bg-white border border-indigo-100 text-indigo-600 rounded-full text-xs font-medium hover:bg-indigo-50 transition-colors animate-fade-in"
                    style="animation-delay: ${index * 100}ms"
                >
                    âœ¨ ${item.zh}
                </button>
            `).join('');
        }

        function renderGrid() {
            if(!activeCategory) return;
            const filtered = currentScenarios.filter(s => s.category === activeCategory);
            gridContainer.innerHTML = '';
            
            filtered.forEach(item => {
                gridContainer.appendChild(createCardElement(item));
            });
        }

        // Helper to create card HTML
        function createCardElement(item, isCustom = false) {
            const card = document.createElement('div');
            card.className = "bg-white rounded-2xl p-6 border border-gray-100 card-anim flex flex-col h-full relative group" + (isCustom ? " animate-fade-in" : "");
            
            const keywordHTML = item.keywords && item.keywords.length > 0 
                ? item.keywords.map(k => `
                    <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-50 text-gray-500 border border-gray-100 zh-font">
                        <span class="en-font font-semibold mr-1">${k.en}</span> <span class="text-gray-400">|</span> <span class="ml-1">${k.zh}</span>
                    </span>`).join('')
                : '';

            // Card HTML
            card.innerHTML = `
                <div class="flex-grow">
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-[10px] font-bold tracking-widest text-gray-300 uppercase en-font">
                            ${isCustom ? 'MY PRACTICE' : 'SENTENCE'}
                        </span>
                    </div>
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2 leading-snug en-font">
                        "${item.goldenSentence}"
                    </h3>
                    <p class="text-gray-500 text-base mb-6 font-medium zh-font">
                        ${item.chinese}
                    </p>
                </div>
                
                ${keywordHTML ? `
                <div class="pt-4 border-t border-dashed border-gray-100 mb-4">
                    <div class="flex flex-wrap gap-2">
                        ${keywordHTML}
                    </div>
                </div>` : ''}
            `;
            return card;
        }

        // --- Custom Card Logic ---

        function handleCustomInput() {
            const input = document.getElementById('custom-zh');
            const text = input.value.trim();
            if(!text) return;
            
            // Show loading state
            const btn = document.getElementById('add-btn');
            const originalBtnContent = btn.innerHTML;
            btn.innerHTML = `<div class="loader"></div>`;
            btn.disabled = true;

            // Start Logic
            addSuggestionCard(text, () => {
                // Callback when done
                btn.innerHTML = originalBtnContent;
                btn.disabled = false;
                input.value = '';
                input.focus();
            });
        }

        function addSuggestionCard(zhText, callback) {
            const pool = suggestionsDB[activeCategory] || [];
            const match = pool.find(item => item.zh === zhText);

            if (match) {
                const newCardData = {
                    goldenSentence: match.en,
                    chinese: match.zh,
                    keywords: match.kw
                };
                addCardToCustomList(newCardData);
                if(callback) callback();
            } else {
                // API Translation
                fetchTranslation(zhText).then(translatedText => {
                    // Extract cleaned keywords
                    const extractedWords = extractKeywords(translatedText);
                    
                    // Async translate keywords
                    Promise.all(extractedWords.map(async (word) => {
                         try {
                             const trans = await fetchTranslation(word, true); 
                             return { en: word, zh: trans };
                         } catch (e) {
                             return { en: word, zh: "" };
                         }
                    })).then(finalKeywords => {
                        const newCardData = {
                            goldenSentence: translatedText, 
                            chinese: zhText,
                            keywords: finalKeywords
                        };
                        addCardToCustomList(newCardData);
                        if(callback) callback();
                    });

                }).catch(err => {
                    console.error("Translation failed", err);
                    const newCardData = {
                        goldenSentence: "Translation unavailable",
                        chinese: zhText,
                        keywords: []
                    };
                    addCardToCustomList(newCardData);
                    if(callback) callback();
                });
            }
        }

        // CLEANER KEYWORD EXTRACTION regex
        function extractKeywords(sentence) {
            if (!sentence) return [];
            // Remove all punctuation except spaces, then split
            // Regex to remove any character that is NOT a letter or whitespace
            // Also removing numbers if needed, but keeping simple for now
            const clean = sentence.replace(/[^\w\s]|_/g, "").replace(/\s+/g, " ");
            const words = clean.split(" ");
            const stopWords = ["a", "an", "the", "is", "are", "was", "were", "to", "in", "on", "at", "for", "of", "my", "your", "his", "her", "it", "that", "this", "i", "you", "he", "she", "we", "they", "me", "him", "us", "them", "not", "do", "does", "did", "will", "would", "can", "could", "so"];
            
            const candidates = words
                .filter(w => !stopWords.includes(w.toLowerCase()) && w.length > 2)
                .sort((a, b) => b.length - a.length); 

            return [...new Set(candidates)].slice(0, 2); 
        }

        async function fetchTranslation(text, isWord = false) {
            try {
                const pair = isWord ? 'en|zh-TW' : 'zh-TW|en';
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${pair}`);
                const data = await response.json();
                if (data && data.responseData && data.responseData.translatedText) {
                    // Remove potential trailing punctuation for keywords
                    let resText = data.responseData.translatedText;
                    if(isWord) {
                        resText = resText.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()ã€‚ï¼Œï¼Ÿï¼]/g,"");
                    }
                    return resText;
                }
                return text;
            } catch (e) {
                return text;
            }
        }

        function addCardToCustomList(data) {
            // Add to specific category list
            if (activeCategory) {
                allCustomCards[activeCategory].push(data);
                renderCustomList();
            }
        }

        function renderCustomList() {
            customListEl.innerHTML = '';
            
            // Get cards for current category
            const currentList = allCustomCards[activeCategory] || [];
            
            if (currentList.length > 0) {
                customCardsContainer.classList.remove('hidden');
                currentList.forEach(item => {
                    const card = createCardElement(item, true);
                    customListEl.appendChild(card);
                });
                
                setTimeout(() => {
                   customListEl.lastElementChild.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            } else {
                customCardsContainer.classList.add('hidden');
            }
        }

        function downloadStudyImage() {
            const captureArea = document.getElementById('custom-list-capture');
            
            if (!captureArea || !allCustomCards[activeCategory] || allCustomCards[activeCategory].length === 0) {
                alert("æ²’æœ‰å…§å®¹å¯ä»¥ä¸‹è¼‰ï¼");
                return;
            }

            document.body.style.cursor = 'wait';

            html2canvas(captureArea, {
                scale: 3,
                backgroundColor: '#ffffff', // Force White Background
                useCORS: true,
                logging: false,
                onclone: (clonedDoc) => {
                    const element = clonedDoc.getElementById('custom-list-capture');
                    element.style.display = 'block';
                    element.style.backgroundColor = '#ffffff';
                    
                    // FORCE ALL TEXT TO BLACK
                    const allElements = element.getElementsByTagName('*');
                    for (let i = 0; i < allElements.length; i++) {
                        const el = allElements[i];
                        // Force solid colors
                        el.style.color = '#000000'; 
                        el.style.opacity = '1';
                        el.style.textShadow = 'none';
                        
                        // Specifically handle gray text which usually disappears
                        if (el.classList.contains('text-gray-400') || el.classList.contains('text-gray-500')) {
                             el.style.color = '#333333'; 
                        }
                        
                        // Fix Card Backgrounds
                        if (el.classList.contains('bg-white')) {
                            el.style.backgroundColor = '#ffffff';
                            el.style.boxShadow = 'none'; // Remove shadow for cleaner print
                            el.style.border = '1px solid #000000'; // Add border to make cards pop
                        }
                    }
                }
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Daily_Conversation_${new Date().toISOString().slice(0,10)}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                document.body.style.cursor = 'default';
            }).catch(err => {
                console.error("Image generation failed", err);
                alert("åœ–ç‰‡ä¸‹è¼‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
                document.body.style.cursor = 'default';
            });
        }

        function copyScenePrompt(btn) {
            const prompt = categorySettings[activeCategory].prompt;
            const textarea = document.createElement('textarea');
            textarea.value = prompt;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            const originalContent = btn.innerHTML;
            btn.innerHTML = `<i class="ph-bold ph-check"></i> <span>å·²è¤‡è£½è§’è‰²è¨­å®šï¼</span>`;
            setTimeout(() => { btn.innerHTML = originalContent; }, 2000);
        }
        
        // Global Mobile Menu Toggle
        document.getElementById('global-mobile-menu-btn').addEventListener('click', () => {
            document.getElementById('global-mobile-menu').classList.toggle('hidden');
        });

        // --- Init ---
        window.addEventListener('DOMContentLoaded', () => {
            renderNav();
            updateView();
        });

    </script>
</body>
</html>
