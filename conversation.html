<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦ç”¨ç”Ÿæ´»è‹±æ–‡ | Chungen English</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #FFFFFF;
            color: #1F2937;
            -webkit-font-smoothing: antialiased;
        }
        
        .en-font { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* è‡ªè¨‚ç´°æ²è»¸ (Sidebarå°ˆç”¨) */
        .thin-scrollbar::-webkit-scrollbar { width: 4px; }
        .thin-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .thin-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .thin-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }

        /* Card Styling */
        .card-shadow {
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 1px 2px -1px rgba(0, 0, 0, 0.04);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-shadow:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        .category-btn { transition: all 0.2s; }
        .category-btn.active {
            background-color: #EEF2FF;
            color: #4F46E5;
            border-right: 3px solid #4F46E5;
            font-weight: 700;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-spin { animation: spin 1s linear infinite; }

        @keyframes slideDown {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .new-card-anim { animation: slideDown 0.3s ease-out forwards; }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: scale(0.9); }
        }
        .delete-anim { animation: fadeOut 0.3s ease-in forwards; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeIn 0.4s ease-out; }

        /* Toast Notification Styling */
        #toast-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }
        .toast {
            background-color: #1F2937;
            color: white;
            padding: 10px 20px;
            border-radius: 9999px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: toastIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
        }
        @keyframes toastIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes toastOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(20px); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col h-screen overflow-hidden">

    <nav class="bg-gray-900 text-white shadow-lg z-[60] flex-shrink-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0 font-bold text-xl tracking-wider cursor-pointer" onclick="switchCategory('home')">
                    <span class="text-white hover:text-yellow-400 transition flex items-center gap-2">
                        <span class="text-2xl">ğŸ“</span> Chungen English
                    </span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition">116 å­¸æ¸¬è‹±æ–‡å…¨æ”»ç•¥</a>
                        <a href="vocab.html" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition">æ­·å±†é«˜é »å–®å­—ç¥å™¨</a>
                        <a href="conversation.html" class="bg-gray-800 text-yellow-400 px-3 py-2 rounded-md text-sm font-bold border border-gray-700">å¯¦ç”¨ç”Ÿæ´»è‹±æ–‡</a>
                        <a href="tutoring.html" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium transition">é—œæ–¼æˆ‘ / å®¶æ•™èª²ç¨‹</a>
                    </div>
                </div>
                <div class="md:hidden flex items-center">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-gray-300 hover:text-white focus:outline-none p-2">
                        â˜°
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800 border-t border-gray-700">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">116 å­¸æ¸¬è‹±æ–‡å…¨æ”»ç•¥</a>
                <a href="vocab.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">æ­·å±†é«˜é »å–®å­—ç¥å™¨</a>
                <a href="conversation.html" class="text-yellow-400 block px-3 py-2 rounded-md text-base font-bold bg-gray-900">å¯¦ç”¨ç”Ÿæ´»è‹±æ–‡</a>
                <a href="tutoring.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">é—œæ–¼æˆ‘ / å®¶æ•™èª²ç¨‹</a>
            </div>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col hidden md:flex h-full">
            <div class="p-5 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition" onclick="switchCategory('home')">
                <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i class="ph-duotone ph-house text-indigo-600"></i>
                    å­¸ç¿’å¤§å»³
                </h2>
                <p class="text-xs text-gray-400 mt-0.5">Dashboard</p>
            </div>
            
            <div class="flex-1 overflow-y-auto thin-scrollbar p-3 space-y-1" id="category-list">
                </div>
            
            <div class="p-4 border-t border-gray-100 bg-gray-50 flex-shrink-0">
                <button onclick="copyScenePrompt()" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-2.5 px-4 rounded-xl text-xs font-bold hover:shadow-lg transition flex items-center justify-center gap-2 shadow-md transform hover:-translate-y-0.5 active:scale-95">
                    <i class="ph-bold ph-sparkle"></i> è¤‡è£½ Gemini è§’è‰²è¨­å®š
                </button>
                <p class="text-[10px] text-gray-400 mt-2 text-center">è²¼çµ¦ Gemini å³å¯é–‹å§‹ AI å°è©±ç·´ç¿’</p>
            </div>
        </aside>

        <div class="md:hidden absolute top-4 left-4 z-40">
            <button onclick="document.querySelector('aside').classList.toggle('hidden');" class="bg-white p-2 rounded-md shadow-md border text-gray-600 hover:bg-gray-50">
                <i class="ph-bold ph-list"></i>
            </button>
        </div>

        <main class="flex-1 flex flex-col h-full bg-gray-50 overflow-hidden relative">
            
            <header id="main-header" class="bg-white border-b border-gray-200 px-6 py-3 flex justify-between items-center shadow-sm flex-shrink-0 hidden">
                <div>
                    <h1 id="current-title" class="text-lg font-bold text-gray-900 flex items-center gap-2">
                        </h1>
                    <p id="current-desc" class="text-xs text-gray-500 mt-0.5">
                        </p>
                </div>
                <div class="flex gap-2">
                    <button onclick="switchCategory('home')" class="flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition text-xs font-medium">
                        <i class="ph-bold ph-arrow-u-up-left"></i> <span class="hidden sm:inline">å›é¦–é </span>
                    </button>
                    <button onclick="generateImage()" class="flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-xs font-medium shadow-sm">
                        <i class="ph-bold ph-download-simple"></i> <span class="hidden sm:inline">ä¸‹è¼‰åœ–å¡</span>
                    </button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-6" id="scroll-container">
                
                <div id="home-view" class="max-w-4xl mx-auto py-4 fade-in px-2 md:px-0">
                    <div class="text-center mb-10">
                        <span class="inline-block px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 font-bold text-xs mb-3 border border-indigo-100">
                            âœ¨ Chungen English ä»²æ©è‹±æ–‡
                        </span>
                        <h1 class="text-3xl font-extrabold text-gray-900 mb-4 leading-tight">
                            æŠŠè‹±èªèå…¥ç”Ÿæ´»ï¼Œ<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-500">é–‹å£å°±æ˜¯é“åœ°èªæ„Ÿã€‚</span>
                        </h1>
                        <p class="text-sm text-gray-500 max-w-xl mx-auto leading-relaxed">
                            æ­¡è¿ä¾†åˆ°æˆ‘çš„å£èªªç©ºé–“ã€‚é€™è£¡æ²’æœ‰æ­»æ¿çš„è€ƒè©¦å£“åŠ›ï¼Œåªæœ‰æˆ‘ç‚ºå¤§å®¶ç²¾é¸çš„ 9 å¤§é«˜é »ç”Ÿæ´»å ´æ™¯èˆ‡é“åœ°èªå¡Šã€‚é€éæ™ºæ…§è¼”åŠ©å·¥å…·ï¼Œå¸Œæœ›ä½ èƒ½è‡ªç„¶è€Œç„¶åœ°é–‹å£èªªè‹±èªã€‚
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
                        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition text-center group">
                            <div class="w-10 h-10 mx-auto bg-blue-50 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition">
                                <i class="ph-duotone ph-speaker-high text-lg text-blue-600"></i>
                            </div>
                            <h3 class="font-bold text-gray-800 text-sm mb-1">è½è¦‹é“åœ°ç™¼éŸ³</h3>
                            <p class="text-gray-400 text-xs">æ¯ä¸€å¥éƒ½å…§å»ºæ¨™æº–ç™¼éŸ³ï¼Œéš¨é»éš¨è½ï¼Œæ ¡æ­£èªèª¿ã€‚</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition text-center group">
                            <div class="w-10 h-10 mx-auto bg-purple-50 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition">
                                <i class="ph-duotone ph-magic-wand text-lg text-purple-600"></i>
                            </div>
                            <h3 class="font-bold text-gray-800 text-sm mb-1">å°ˆå±¬èªå¥æ”¶è—</h3>
                            <p class="text-gray-400 text-xs">è¼¸å…¥ä¸­æ–‡ï¼Œç³»çµ±è‡ªå‹•ç¿»è­¯ä¸¦ç”Ÿæˆä½ çš„å°ˆå±¬ç­†è¨˜å¡ç‰‡ã€‚</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition text-center group">
                            <div class="w-10 h-10 mx-auto bg-yellow-50 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition">
                                <i class="ph-duotone ph-student text-lg text-yellow-600"></i>
                            </div>
                            <h3 class="font-bold text-gray-800 text-sm mb-1">ä»²æ©åš´é¸æƒ…å¢ƒ</h3>
                            <p class="text-gray-400 text-xs">ä¸èƒŒå–®å­—èƒŒèªå¡Šã€‚é€™äº›éƒ½æ˜¯åœ‹å¤–ç”Ÿæ´»çœŸæ­£æœƒç”¨åˆ°çš„å°è©±ã€‚</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-4 mb-4">
                        <div class="h-px bg-gray-200 flex-1"></div>
                        <span class="text-gray-400 font-bold text-xs tracking-wider uppercase">é¸æ“‡ä¸€å€‹ä¸»é¡Œé–‹å§‹</span>
                        <div class="h-px bg-gray-200 flex-1"></div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3" id="home-categories"></div>
                </div>

                <div id="category-view" class="hidden fade-in max-w-5xl mx-auto">
                    
                    <div class="mb-6 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-xl p-5 shadow-md text-white">
                        <h3 class="font-bold mb-3 flex items-center gap-2 text-base">
                            <i class="ph-fill ph-magic-wand text-yellow-300"></i> æ™ºæ…§ç¿»è­¯åŠ©æ‰‹
                        </h3>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <div class="flex-1">
                                <input type="text" id="custom-ch" placeholder="è«‹è¼¸å…¥ä¸­æ–‡" 
                                    class="w-full px-4 py-2.5 rounded-lg border-none text-sm text-gray-800 placeholder-gray-400 outline-none transition shadow-inner">
                            </div>
                            <button onclick="addCustomCard()" id="generate-btn" class="bg-yellow-400 text-indigo-900 px-5 py-2.5 rounded-lg text-sm font-bold hover:bg-yellow-300 transition shadow-lg flex items-center justify-center gap-2 min-w-[120px]">
                                <i class="ph-bold ph-translate"></i> ç”Ÿæˆå¡ç‰‡
                            </button>
                        </div>
                    </div>

                    <div id="capture-wrapper">
                        <div id="custom-cards-section" class="hidden mb-8">
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i class="ph-fill ph-star text-yellow-500"></i> âœ¨ æˆ‘çš„å°ˆå±¬å­¸ç¿’å€
                            </h4>
                            <div id="custom-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                            <div class="border-b border-gray-200 my-6"></div>
                        </div>

                        <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-20"></div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="toast-container"></div>

    <script>
        const categorySettings = {
            "business": { icon: "ph-briefcase", label: "è·å ´å•†å‹™", title: "Business & Workplace", desc: "æœƒè­°ã€ç°¡å ±èˆ‡è·å ´ç¤¾äº¤ç”¨èªã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œè·å ´å•†å‹™ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "Let's get down to business.", ch: "æˆ‘å€‘è¨€æ­¸æ­£å‚³å§ã€‚", tag: "Meeting" }, { en: "I'd like to propose a new strategy.", ch: "æˆ‘æƒ³æå‡ºä¸€å€‹æ–°ç­–ç•¥ã€‚", tag: "Proposal" }, { en: "Could you elaborate on that point?", ch: "ä½ å¯ä»¥è©³ç´°èªªæ˜é‚£ä¸€é»å—ï¼Ÿ", tag: "Clarify" }, { en: "We are on the same page.", ch: "æˆ‘å€‘çš„çœ‹æ³•ä¸€è‡´ã€‚", tag: "Agreement" }, { en: "I'll follow up with an email.", ch: "æˆ‘ç¨å¾Œæœƒç™¼ä¸€å°éƒµä»¶è·Ÿé€²ã€‚", tag: "Follow-up" }, { en: "What's the deadline for this project?", ch: "é€™å€‹å°ˆæ¡ˆçš„æˆªæ­¢æ—¥æœŸæ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", tag: "Schedule" }, { en: "Let's wrap up this meeting.", ch: "æˆ‘å€‘çµæŸé€™å ´æœƒè­°å§ã€‚", tag: "Closing" }, { en: "Thinking outside the box is crucial.", ch: "è·³è„«æ¡†æ¶æ€è€ƒå¾ˆé—œéµã€‚", tag: "Idiom" }, { en: "I'll keep you in the loop.", ch: "æˆ‘æœƒéš¨æ™‚è®“ä½ äº†è§£é€²åº¦ã€‚", tag: "Update" }] },
            "travel": { icon: "ph-airplane-tilt", label: "æ—…éŠæ©Ÿå ´", title: "Travel & Airport", desc: "æ©Ÿå ´å ±åˆ°ã€è½‰æ©Ÿèˆ‡è©¢å•è³‡è¨Šã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œæ—…éŠæ©Ÿå ´ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "I'd like to check in for my flight.", ch: "æˆ‘æƒ³è¾¦ç†ç™»æ©Ÿæ‰‹çºŒã€‚", tag: "Check-in" }, { en: "Is there a layover for this flight?", ch: "é€™ç­é£›æ©Ÿæœ‰è½‰æ©Ÿå—ï¼Ÿ", tag: "Flight" }, { en: "Where can I claim my baggage?", ch: "å“ªè£¡å¯ä»¥é ˜å–è¡Œæï¼Ÿ", tag: "Baggage" }, { en: "I have nothing to declare.", ch: "æˆ‘æ²’æœ‰éœ€è¦ç”³å ±çš„æ±è¥¿ã€‚", tag: "Customs" }, { en: "Could I get a window seat, please?", ch: "å¯ä»¥çµ¦æˆ‘é çª—çš„ä½å­å—ï¼Ÿ", tag: "Seat" }, { en: "How do I get to the city center?", ch: "æˆ‘è©²å¦‚ä½•å‰å¾€å¸‚ä¸­å¿ƒï¼Ÿ", tag: "Transport" }, { en: "My flight has been delayed.", ch: "æˆ‘çš„èˆªç­å»¶èª¤äº†ã€‚", tag: "Status" }, { en: "Is breakfast included in the stay?", ch: "ä½å®¿åŒ…å«æ—©é¤å—ï¼Ÿ", tag: "Hotel" }, { en: "Can you recommend a local attraction?", ch: "ä½ èƒ½æ¨è–¦ä¸€å€‹ç•¶åœ°çš„æ™¯é»å—ï¼Ÿ", tag: "Sightseeing" }] },
            "restaurant": { icon: "ph-fork-knife", label: "é¤é£²è‹±æ–‡", title: "Restaurant & Dining", desc: "è¨‚ä½ã€é»é¤èˆ‡ç‰¹æ®Šé£²é£Ÿéœ€æ±‚ã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œé¤å»³é»é¤ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "A table for two, please.", ch: "è«‹çµ¦æˆ‘å…©ä½å®¢äººçš„ä½å­ã€‚", tag: "Seating" }, { en: "May I see the menu?", ch: "å¯ä»¥çµ¦æˆ‘çœ‹èœå–®å—ï¼Ÿ", tag: "Menu" }, { en: "What's the specialty of the house?", ch: "ä½ å€‘çš„æ‹›ç‰Œèœæ˜¯ä»€éº¼ï¼Ÿ", tag: "Recommend" }, { en: "I'm allergic to peanuts.", ch: "æˆ‘å°èŠ±ç”Ÿéæ•ã€‚", tag: "Allergy" }, { en: "I'll have the same as her.", ch: "æˆ‘è¦è·Ÿå¥¹é»ä¸€æ¨£çš„ã€‚", tag: "Order" }, { en: "Can we have the check, please?", ch: "å¯ä»¥å¹«æˆ‘å€‘çµå¸³å—ï¼Ÿ", tag: "Bill" }, { en: "Is it possible to make a reservation?", ch: "å¯ä»¥è¨‚ä½å—ï¼Ÿ", tag: "Booking" }, { en: "This isn't what I ordered.", ch: "é€™ä¸æ˜¯æˆ‘é»çš„èœã€‚", tag: "Issue" }, { en: "Keep the change.", ch: "ä¸ç”¨æ‰¾éŒ¢äº†ã€‚", tag: "Tip" }] },
            "dating": { icon: "ph-heart", label: "ç¤¾äº¤ç´„æœƒ", title: "Dating & Romance", desc: "è¡¨é”å¥½æ„Ÿã€ç¨±è®šèˆ‡ç´„æœƒç”¨èªã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œç¤¾äº¤ç´„æœƒã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "Would you like to grab a coffee?", ch: "æƒ³å»å–æ¯å’–å•¡å—ï¼Ÿ", tag: "Invitation" }, { en: "I had a great time tonight.", ch: "æˆ‘ä»Šæ™šéå¾—å¾ˆé–‹å¿ƒã€‚", tag: "Feeling" }, { en: "You look stunning today.", ch: "ä½ ä»Šå¤©çœ‹èµ·ä¾†å¾ˆè¿·äººã€‚", tag: "Compliment" }, { en: "Are you seeing anyone lately?", ch: "ä½ æœ€è¿‘æœ‰åœ¨è·Ÿèª°äº¤å¾€å—ï¼Ÿ", tag: "Inquiry" }, { en: "I'm really into you.", ch: "æˆ‘å¾ˆä¸­æ„ä½ ã€‚", tag: "Confession" }, { en: "Let's keep in touch.", ch: "ä¿æŒè¯çµ¡ã€‚", tag: "Contact" }, { en: "What do you do for fun?", ch: "ä½ å¹³å¸¸æœ‰ä»€éº¼ä¼‘é–’å—œå¥½ï¼Ÿ", tag: "Hobby" }, { en: "Can I walk you home?", ch: "æˆ‘å¯ä»¥é™ªä½ èµ°å›å®¶å—ï¼Ÿ", tag: "Polite" }, { en: "I think we have a lot in common.", ch: "æˆ‘è¦ºå¾—æˆ‘å€‘æœ‰å¾ˆå¤šå…±åŒé»ã€‚", tag: "Connection" }] },
            "shopping": { icon: "ph-bag", label: "è³¼ç‰©æ¶ˆè²»", title: "Shopping & Retail", desc: "æ®ºåƒ¹ã€é€€æ›è²¨èˆ‡å°‹æ‰¾å•†å“ã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œè³¼ç‰©æ¶ˆè²»ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "I'm just looking, thanks.", ch: "æˆ‘åªæ˜¯çœ‹çœ‹ï¼Œè¬è¬ã€‚", tag: "Browsing" }, { en: "Does this come in another color?", ch: "é€™å€‹æœ‰åˆ¥çš„é¡è‰²å—ï¼Ÿ", tag: "Option" }, { en: "Where is the fitting room?", ch: "è©¦è¡£é–“åœ¨å“ªè£¡ï¼Ÿ", tag: "Location" }, { en: "Is this on sale?", ch: "é€™å€‹æœ‰æ‰“æŠ˜å—ï¼Ÿ", tag: "Discount" }, { en: "It's a bit out of my budget.", ch: "é€™æœ‰é»è¶…å‡ºæˆ‘çš„é ç®—ã€‚", tag: "Price" }, { en: "Can I get a discount?", ch: "å¯ä»¥çµ¦æˆ‘æŠ˜æ‰£å—ï¼Ÿ", tag: "Bargain" }, { en: "I'd like to return this item.", ch: "æˆ‘æƒ³é€€æ‰é€™ä»¶å•†å“ã€‚", tag: "Return" }, { en: "Do you accept credit cards?", ch: "ä½ å€‘æ”¶ä¿¡ç”¨å¡å—ï¼Ÿ", tag: "Payment" }, { en: "It fits like a glove.", ch: "é€™ä»¶ç©¿èµ·ä¾†éå¸¸åˆèº«ã€‚", tag: "Fitting" }] },
            "hotel": { icon: "ph-bed", label: "é£¯åº—ä½å®¿", title: "Hotel & Accommodation", desc: "å…¥ä½é€€æˆ¿ã€å®¢æˆ¿æœå‹™èˆ‡è¨­æ–½è©¢å•ã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œé£¯åº—ä½å®¿ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "I have a reservation under my name.", ch: "æˆ‘æœ‰é ç´„ï¼Œåå­—æ˜¯...", tag: "Check-in" }, { en: "Is there free Wi-Fi here?", ch: "é€™è£¡æœ‰å…è²» Wi-Fi å—ï¼Ÿ", tag: "Internet" }, { en: "Could I have some extra towels?", ch: "å¯ä»¥å¤šçµ¦æˆ‘å¹¾æ¢æ¯›å·¾å—ï¼Ÿ", tag: "Request" }, { en: "What time is check-out?", ch: "é€€æˆ¿æ™‚é–“æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", tag: "Info" }, { en: "The air conditioner isn't working.", ch: "å†·æ°£å£æ‰äº†ã€‚", tag: "Complaint" }, { en: "Can I leave my bags here?", ch: "æˆ‘å¯ä»¥æŠŠè¡Œæå¯„æ”¾åœ¨é€™å—ï¼Ÿ", tag: "Service" }, { en: "Is there a gym in the hotel?", ch: "é£¯åº—å…§æœ‰å¥èº«æˆ¿å—ï¼Ÿ", tag: "Facility" }, { en: "Can you wake me up at 7 AM?", ch: "æ—©ä¸Šä¸ƒé»å¯ä»¥å«æˆ‘èµ·åºŠå—ï¼Ÿ", tag: "Wake-up" }, { en: "I'd like to extend my stay.", ch: "æˆ‘æƒ³å»¶é•·çºŒä½ã€‚", tag: "Extend" }] },
            "transport": { icon: "ph-train", label: "äº¤é€šé€šå‹¤", title: "Transportation", desc: "å¤§çœ¾é‹è¼¸ã€å•è·¯èˆ‡ä¹˜è»Šç”¨èªã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œäº¤é€šé€šå‹¤ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "Where is the nearest subway station?", ch: "æœ€è¿‘çš„æ·é‹ç«™åœ¨å“ªï¼Ÿ", tag: "Direction" }, { en: "How much is the fare to the airport?", ch: "å»æ©Ÿå ´çš„è»Šè³‡æ˜¯å¤šå°‘ï¼Ÿ", tag: "Fare" }, { en: "Does this bus go to downtown?", ch: "é€™è¼›å…¬è»Šæœ‰å»å¸‚ä¸­å¿ƒå—ï¼Ÿ", tag: "Route" }, { en: "Please pull over here.", ch: "è«‹åœ¨é€™é‚Šé é‚Šåœè»Šã€‚", tag: "Taxi" }, { en: "The train is bound for London.", ch: "é€™ç­ç«è»Šå‰å¾€å€«æ•¦ã€‚", tag: "Destination" }, { en: "How often does the shuttle run?", ch: "æ¥é§è»Šå¤šä¹…ä¸€ç­ï¼Ÿ", tag: "Schedule" }, { en: "I missed my transfer.", ch: "æˆ‘éŒ¯éäº†è½‰ä¹˜ã€‚", tag: "Problem" }, { en: "Is this seat taken?", ch: "é€™å€‹ä½å­æœ‰äººåå—ï¼Ÿ", tag: "Seat" }, { en: "You need to top up your card.", ch: "ä½ çš„å¡ç‰‡éœ€è¦å„²å€¼ã€‚", tag: "Card" }] },
            "health": { icon: "ph-first-aid", label: "é†«ç™‚å¥åº·", title: "Health & Medical", desc: "èº«é«”ä¸é©ã€çœ‹è¨ºèˆ‡è—¥å±€ç”¨èªã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œé†«ç™‚å¥åº·ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "I'm not feeling well.", ch: "æˆ‘è¦ºå¾—ä¸å¤ªèˆ’æœã€‚", tag: "Symptom" }, { en: "I have a splitting headache.", ch: "æˆ‘é ­ç—›æ¬²è£‚ã€‚", tag: "Pain" }, { en: "Where is the pharmacy?", ch: "è—¥å±€åœ¨å“ªè£¡ï¼Ÿ", tag: "Location" }, { en: "I'd like to make an appointment.", ch: "æˆ‘æƒ³æ›è™Ÿé ç´„ã€‚", tag: "Doctor" }, { en: "Are there any side effects?", ch: "æœ‰ä»€éº¼å‰¯ä½œç”¨å—ï¼Ÿ", tag: "Medicine" }, { en: "How often should I take this?", ch: "é€™è—¥å¤šä¹…åƒä¸€æ¬¡ï¼Ÿ", tag: "Dosage" }, { en: "I've been feeling dizzy lately.", ch: "æˆ‘æœ€è¿‘ä¸€ç›´è¦ºå¾—é ­æšˆã€‚", tag: "Condition" }, { en: "Does it hurt here?", ch: "é€™è£¡æœƒç—›å—ï¼Ÿ", tag: "Exam" }, { en: "I need a medical certificate.", ch: "æˆ‘éœ€è¦ä¸€å¼µè¨ºæ–·è­‰æ˜æ›¸ã€‚", tag: "Doc" }] },
            "home": { icon: "ph-house", label: "å±…å®¶ç”Ÿæ´»", title: "Daily Life & Home", desc: "å®¶äº‹ã€æ—¥å¸¸è«‹æ±‚èˆ‡å®¶åº­å°è©±ã€‚", prompt: "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹è·Ÿæˆ‘é€²è¡Œã€Œå±…å®¶ç”Ÿæ´»ã€çš„è§’è‰²æ‰®æ¼”ã€‚", sentences: [{ en: "Can you help me with the chores?", ch: "ä½ èƒ½å¹«æˆ‘åšå®¶äº‹å—ï¼Ÿ", tag: "Chores" }, { en: "We're running out of milk.", ch: "æˆ‘å€‘çš„ç‰›å¥¶å¿«å–å®Œäº†ã€‚", tag: "Grocery" }, { en: "Make yourself at home.", ch: "ç•¶ä½œè‡ªå·±å®¶ï¼Œåˆ¥å®¢æ°£ã€‚", tag: "Guest" }, { en: "The trash needs to be taken out.", ch: "åƒåœ¾è©²æ‹¿å‡ºå»å€’äº†ã€‚", tag: "Trash" }, { en: "Could you turn down the volume?", ch: "å¯ä»¥æŠŠéŸ³é‡èª¿å°è²ä¸€é»å—ï¼Ÿ", tag: "Noise" }, { en: "I'm going to do the laundry.", ch: "æˆ‘è¦å»æ´—è¡£æœã€‚", tag: "Washing" }, { en: "What's for dinner tonight?", ch: "ä»Šæ™šæ™šé¤åƒä»€éº¼ï¼Ÿ", tag: "Dinner" }, { en: "Don't forget to lock the door.", ch: "åˆ¥å¿˜äº†é–é–€ã€‚", tag: "Safety" }, { en: "I need to tidy up my room.", ch: "æˆ‘éœ€è¦æ•´ç†æˆ‘çš„æˆ¿é–“ã€‚", tag: "Cleaning" }] }
        };

        let activeCategory = "home"; 

        function renderNav() {
            const list = document.getElementById('category-list');
            list.innerHTML = '';
            
            Object.keys(categorySettings).forEach(key => {
                const item = categorySettings[key];
                const isActive = key === activeCategory;
                
                const btn = document.createElement('button');
                btn.className = `category-btn w-full text-left px-3 py-2.5 rounded-lg flex items-center gap-2.5 text-sm transition-all ${isActive ? 'active' : 'text-gray-600 hover:bg-gray-50'}`;
                btn.onclick = () => switchCategory(key);
                btn.innerHTML = `
                    <i class="${isActive ? 'ph-duotone' : 'ph'} ${item.icon} text-lg ${isActive ? 'text-indigo-600' : 'text-gray-400'}"></i>
                    <span class="font-medium">${item.label}</span>
                `;
                list.appendChild(btn);
            });
        }

        function renderHome() {
            const homeContainer = document.getElementById('home-categories');
            homeContainer.innerHTML = '';

            Object.keys(categorySettings).forEach(key => {
                const item = categorySettings[key];
                const card = document.createElement('div');
                card.className = "bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:border-indigo-200 transition cursor-pointer flex items-center gap-3 group";
                card.onclick = () => switchCategory(key);
                card.innerHTML = `
                    <div class="w-10 h-10 rounded-lg bg-indigo-50 flex items-center justify-center group-hover:bg-indigo-600 transition flex-shrink-0">
                        <i class="ph-duotone ${item.icon} text-xl text-indigo-600 group-hover:text-white transition"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-800 text-sm">${item.label}</h4>
                        <p class="text-[10px] text-gray-500">${item.sentences.length} å¥ç²¾é¸</p>
                    </div>
                    <i class="ph-bold ph-caret-right text-gray-300 group-hover:text-indigo-600"></i>
                `;
                homeContainer.appendChild(card);
            });
        }

        function switchCategory(key) {
            activeCategory = key;
            renderNav();
            updateView();
            resetCustomInput(); 
        }

        function resetCustomInput() {
            const input = document.getElementById('custom-ch');
            const btn = document.getElementById('generate-btn');
            if (input) input.value = '';
            if (btn) {
                btn.innerHTML = `<i class="ph-bold ph-translate"></i> ç”Ÿæˆå¡ç‰‡`;
                btn.disabled = false;
            }
        }

        function updateView() {
            const homeView = document.getElementById('home-view');
            const categoryView = document.getElementById('category-view');
            const mainHeader = document.getElementById('main-header');

            if (activeCategory === 'home') {
                homeView.classList.remove('hidden');
                categoryView.classList.add('hidden');
                mainHeader.classList.add('hidden');
                renderHome();
            } else {
                homeView.classList.add('hidden');
                categoryView.classList.remove('hidden');
                mainHeader.classList.remove('hidden');

                const data = categorySettings[activeCategory];
                
                document.getElementById('current-title').innerHTML = `
                    <i class="ph-duotone ${data.icon} text-indigo-600"></i> ${data.title}
                `;
                document.getElementById('current-desc').textContent = data.desc;

                const container = document.getElementById('cards-container');
                container.innerHTML = '';

                data.sentences.forEach(s => {
                    const card = createCardElement(s.en, s.ch, s.tag, false);
                    container.appendChild(card);
                });

                loadCustomCards();
            }
        }

        function createCardElement(en, ch, tag, isCustom, timestamp) {
            const card = document.createElement('div');
            const bgClass = isCustom ? "bg-yellow-50 border-yellow-200 ring-2 ring-yellow-100" : "bg-white border-gray-100";
            const tagClass = isCustom ? "bg-yellow-200 text-yellow-800" : "bg-gray-100 text-gray-500";
            
            // Add Delete button if Custom
            const deleteBtn = isCustom ? `
                <button onclick="deleteCustomCard(${timestamp})" class="p-1.5 bg-red-50 text-red-500 rounded-full hover:bg-red-100 transition mr-2" title="åˆªé™¤å¡ç‰‡">
                    <i class="ph-bold ph-trash text-lg"></i>
                </button>
            ` : '';

            card.className = `${bgClass} p-5 rounded-xl border card-shadow relative group ${isCustom ? 'delete-anim-enter' : ''}`;
            card.innerHTML = `
                <div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity flex items-center">
                    ${deleteBtn}
                    <button onclick="speak('${en.replace(/'/g, "\\'")}')" class="p-1.5 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100 transition">
                        <i class="ph-bold ph-speaker-high text-lg"></i>
                    </button>
                </div>
                <span class="inline-block px-2 py-0.5 ${tagClass} text-[10px] font-bold rounded-md mb-2">
                    ${tag}
                </span>
                <h3 class="text-lg font-bold text-gray-800 mb-1 en-font leading-tight">${en}</h3>
                <p class="text-xs text-gray-500 font-medium">${ch}</p>
            `;
            return card;
        }

        // --- Custom Card Logic ---
        function loadCustomCards() {
            const container = document.getElementById('custom-cards-container');
            const section = document.getElementById('custom-cards-section');
            container.innerHTML = ''; 

            const storedCards = JSON.parse(localStorage.getItem('myCustomCards')) || [];
            
            if (storedCards.length > 0) {
                section.classList.remove('hidden');
                storedCards.slice().reverse().forEach(cardData => {
                    const card = createCardElement(cardData.en, cardData.ch, "è‡ªè¨‚å¥å‹", true, cardData.date);
                    container.appendChild(card);
                });
            } else {
                section.classList.add('hidden');
            }
        }

        async function addCustomCard() {
            const chInput = document.getElementById('custom-ch');
            const chText = chInput.value.trim();
            const btn = document.getElementById('generate-btn');
            const originalBtnContent = `<i class="ph-bold ph-translate"></i> ç”Ÿæˆå¡ç‰‡`;

            if (!chText) {
                showToast("è«‹è¼¸å…¥ä¸­æ–‡", "warning");
                return;
            }

            btn.innerHTML = `<i class="ph-bold ph-spinner loading-spin"></i> ç¿»è­¯ä¸­...`;
            btn.disabled = true;

            const timeout = setTimeout(() => {
                if (btn.disabled) {
                    btn.innerHTML = originalBtnContent;
                    btn.disabled = false;
                    showToast("é€£ç·šé€¾æ™‚ï¼Œè«‹é‡è©¦", "error");
                }
            }, 8000);

            try {
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(chText)}&langpair=zh|en`);
                const data = await response.json();
                
                clearTimeout(timeout); 

                if (data && data.responseData) {
                    const enText = data.responseData.translatedText;
                    
                    const newCardData = { en: enText, ch: chText, date: new Date().getTime() };
                    const storedCards = JSON.parse(localStorage.getItem('myCustomCards')) || [];
                    storedCards.push(newCardData);
                    localStorage.setItem('myCustomCards', JSON.stringify(storedCards));

                    loadCustomCards();
                    chInput.value = '';
                    showToast("âœ¨ å¡ç‰‡ç”ŸæˆæˆåŠŸï¼", "success");
                } else {
                    showToast("ç¿»è­¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚", "error");
                }
            } catch (error) {
                console.error("Translation error:", error);
                showToast("é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚", "error");
            } finally {
                btn.innerHTML = originalBtnContent;
                btn.disabled = false;
            }
        }

        function deleteCustomCard(timestamp) {
            if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å¼µå­¸ç¿’å¡å—ï¼Ÿ")) return;

            const storedCards = JSON.parse(localStorage.getItem('myCustomCards')) || [];
            const newCards = storedCards.filter(card => card.date !== timestamp);
            localStorage.setItem('myCustomCards', JSON.stringify(newCards));
            
            loadCustomCards();
            showToast("ğŸ—‘ï¸ å¡ç‰‡å·²åˆªé™¤", "success");
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function generateImage() {
            document.body.style.cursor = 'wait';
            const captureArea = document.getElementById('capture-wrapper');
            
            // Temporary expand height to ensure full capture
            const originalHeight = captureArea.style.height;
            
            html2canvas(captureArea, {
                scale: 2,
                backgroundColor: "#F9FAFB",
                useCORS: true,
                logging: false,
                windowHeight: captureArea.scrollHeight
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Chungen_English_Review_${new Date().toISOString().slice(0,10)}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                document.body.style.cursor = 'default';
                showToast("ğŸ“¥ åœ–ç‰‡ä¸‹è¼‰æˆåŠŸï¼", "success");
            }).catch(err => {
                console.error(err);
                showToast("åœ–ç‰‡ä¸‹è¼‰å¤±æ•—", "error");
                document.body.style.cursor = 'default';
            });
        }

        function copyScenePrompt() {
            let promptText = "ä½ ç¾åœ¨æ˜¯æˆ‘çš„è‹±æ–‡æ•™ç·´ã€‚è«‹ä¿®æ­£æˆ‘çš„æ–‡æ³•éŒ¯èª¤ï¼Œä¸¦æä¾›æ›´é“åœ°çš„èªªæ³•ã€‚";
            if (activeCategory !== 'home') {
                promptText = categorySettings[activeCategory].prompt;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = promptText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showToast("âœ… å·²è¤‡è£½ Gemini è§’è‰²è¨­å®šï¼", "success");
        }

        function showToast(message, type = "success") {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            let icon = 'check-circle';
            if (type === 'error') icon = 'warning-circle';
            if (type === 'warning') icon = 'info';

            toast.innerHTML = `<i class="ph-fill ph-${icon} text-lg"></i> ${message}`;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'toastOut 0.3s ease-in forwards';
                toast.addEventListener('animationend', () => toast.remove());
            }, 3000);
        }

        // --- Init ---
        window.addEventListener('DOMContentLoaded', () => {
            renderNav();
            updateView();
        });

    </script>
</body>
</html>
